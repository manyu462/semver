#!/bin/bash

# Ensure script stops on error
set -e

VERSION_FILE="version.txt"

# Read current version
if [ ! -f "$VERSION_FILE" ]; then
  echo "0.1.0" > "$VERSION_FILE"
fi

CURRENT_VERSION=$(cat "$VERSION_FILE")

# Bump version
NEW_VERSION=$(semver -i "$1" "$CURRENT_VERSION")

# Save new version
echo "$NEW_VERSION" > "$VERSION_FILE"

# Commit and tag
git config --global user.name "github-actions[bot]"
git config --global user.email "github-actions[bot]@users.noreply.github.com"

git add "$VERSION_FILE"
git commit -m "chore: bump version to $NEW_VERSION"
git tag "v$NEW_VERSION"
git push origin main --tags

# Output new version
echo "$NEW_VERSION"
